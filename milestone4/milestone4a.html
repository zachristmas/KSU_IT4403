<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mustache@4.2.0/mustache.min.js"></script>
    <style>
        body {
            font-family: Arial;
            margin: 0;
        }

        * {
            box-sizing: border-box;
        }

        .topnav {
            overflow: hidden;
            background-color: #333;
            position: sticky;
        }

        .topnav a {
            float: left;
            color: #f2f2f2;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
            font-size: 17px;
        }

        .topnav a:hover {
            background-color: #ddd;
            color: black;
        }

        .topnav a.active {
            background-color: #8c8e88;
            color: white;
        }

        #app {
            padding: 20px;
        }

        .pagination {
            display: inline-block;
        }

        .pagination a {
            color: black;
            float: left;
            padding: 8px 16px;
            text-decoration: none;
        }

        .pagination a.active {
            background-color: #0b7dda;
            color: white;
        }

        .pagination a:hover:not(.active) {
            background-color: #ddd;
        }

        form.search input[type=text] {
            padding: 10px;
            font-size: 17px;
            border: 1px solid grey;
            float: left;
            width: 80%;
            background: #f1f1f1;
        }

        form.search button {
            float: left;
            width: 20%;
            padding: 10px;
            background: #2196F3;
            color: white;
            font-size: 17px;
            border: 1px solid grey;
            border-left: none;
            cursor: pointer;
        }

        form.search button:hover {
            background: #0b7dda;
        }

        form.search::after {
            content: "";
            clear: both;
            display: table;
        }

        .paging-container {
            padding: 20px;
        }

        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
            font-size: 17px;
        }

        /* Change background color of buttons on hover */
        .tab button:hover {
            background-color: #ddd;
        }

        /* Create an active/current tablink class */
        .tab button.active {
            background-color: #2196F3;
            color: white;
        }

        /* Style the tab content */
        .tabcontent {
            display: none;
            padding: 20px;
            border: 1px solid #ccc;
            border-top: none;
        }

        /* Create two equal columns that floats next to each other */
        .column {
            float: left;
            width: 50%;
            padding: 10px;
        }

        /* Clear floats after the columns */
        .row:after {
            content: "";
            display: table;
            clear: both;
        }

        /* Style the buttons */
        .btn {
            border: none;
            outline: none;
            padding: 12px 16px;
            background-color: #f1f1f1;
            cursor: pointer;
        }

        .btn:hover {
            background-color: #ddd;
        }

        .btn.active {
            background-color: #666;
            color: white;
        }


        /* The Modal (background) */
        .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            z-index: 1;
            /* Sit on top */
            padding-top: 100px;
            /* Location of the box */
            left: 0;
            top: 0;
            width: 100%;
            /* Full width */
            height: 100%;
            /* Full height */
            overflow: auto;
            /* Enable scroll if needed */
            background-color: rgb(0, 0, 0);
            /* Fallback color */
            background-color: rgba(0, 0, 0, 0.4);
            /* Black w/ opacity */
        }

        /* Modal Content */
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        /* The Close Button */
        .close {
            color: #aaaaaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        .container {
            border: 2px solid #ccc;
            background-color: #eee;
            border-radius: 5px;
            padding: 16px;
            margin: 16px 0;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <div class="topnav">
        <a href="../index.html">HOME</a>
        <a href="../milestone1/milestone1a.html">MILESTONE 1a</a>
        <a href="../milestone1/milestone1b.html">MILESTONE 1b</a>
        <a href="../milestone2/milestone2a.html">MILESTONE 2</a>
        <a href="../milestone3/milestone3a.html">MILESTONE 3</a>
        <a class="active" href="#">MILESTONE 4</a>
    </div>
    <div class="tab">
        <button class="tablinks active" onclick="openTab(event, 'SearchBooks')">Search Books</button>
        <button class="tablinks" onclick="openTab(event, 'MyBookshelf')">My Bookshelf</button>
    </div>
    <br>
    <br>
    <!-- The Modal -->
    <div id="myModal" class="modal"></div>
    <br />
    <div id="btnContainer" style="padding: 10px;">
        <button id="listViewBtn" class="btn" onclick="listView()"><i class="fa fa-bars"></i> List</button>
        <button id="gridViewBtn" class="btn active" onclick="gridView()"><i class="fa fa-th-large"></i> Grid</button>
    </div>

    <div id="SearchBooks" class="tabcontent" style="display:block;">
        <h2>Search for a book:</h2>
        <form id="searchForm" class="search" style="max-width:300px" action="Javascript:void(0)">
            <input id="searchInput" type="text" placeholder="Search.." name="search2">
            <button type="submit"><i class="fa fa-search"></i></button>
        </form>
        <br>
        <div id="pageSelect" class="pagination"></div>
        <br>
        <div id="bookContainer"></div>
    </div>

    <div id="MyBookshelf" class="tabcontent">
        <h2>My Bookshelf: </h2>
        <div id="bookShelfContainer"></div>
    </div>

    <script>
        // Get the modal
        var modal = document.getElementById("myModal");

        // When the user clicks the button, open the modal 
        function displayModal(modalData) {
            modal.style.display = "block";
            var modalTemplate = `
                <div class="modal-content">
                    <span class="close" onclick="closeModal()">&times;</span>
                    <div>
                        <img src="{{volumeInfo.imageLinks.smallThumbnail}}" alt="{{volumeInfo.title}}" style="width:90px">
                        <h3><strong>{{volumeInfo.title}}</strong>: {{volumeInfo.subtitle}}</h3>
                        <p><strong>{{#volumeInfo.authors}} {{.}} {{/volumeInfo.authors}}</strong></p>
                        <p>{{volumeInfo.publisher}}, {{volumeInfo.publishedDate}} - {{volumeInfo.pageCount}} pages</p>
                        
                        <p>{{{volumeInfo.description}}}</p>
                        <hr>
                        <h4>Details</h4>
                        <ul style=width: 50%;>
                            <li>Publisher: {{volumeInfo.publisher}}</li>
                                <li>Publish Date: {{volumeInfo.publishedDate}}</li>
                                <li>Page Count: {{volumeInfo.pageCount}}</li>
                                <li>Print Type: {{volumeInfo.printType}}</li>
                                <li>Categories: {{#volumeInfo.categories}} {{.}} {{/volumeInfo.categories}}</li>
                                <li>Sale Info: {{saleInfo.saleability}}</li>
                        </ul>
                    </div>
                </div>
            `;

            var html = Mustache.render(modalTemplate, modalData);
            $('#myModal').html(html);
        }

        // When the user clicks on <span> (x), close the modal
        function closeModal() {
            $('#myModal').hide()
            $('#myModal').empty();
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target == modal) {
                $('#myModal').hide()
                $('#myModal').empty();
            }
        }

        // Get the elements with class="column"
        var elements = document.getElementsByClassName("column");

        // List View
        function listView() {
            window.viewType = 'list';
            document.getElementById('listViewBtn').className = "btn active";
            document.getElementById('gridViewBtn').className = "btn";
            for (var i = 0; i < elements.length; i++) {
                elements[i].style.width = "100%";
            }
        }

        // Grid View
        function gridView() {
            window.viewType = 'grid';
            document.getElementById('listViewBtn').className = "btn";
            document.getElementById('gridViewBtn').className = "btn active";
            for (i = 0; i < elements.length; i++) {
                elements[i].style.width = "50%";
            }
        }

        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        function handlePaging(pageNumber) {
            if (pageNumber == window.currentPage) {
                return;
            }
            else {
                window.currentPage = pageNumber;
            }
            $('#bookContainer').empty();
            const searchTerm = window.currentTerm;
            let index = 1;
            if (window.currentPage != 1) {
                index = (10 * pageNumber) + 1;
            }
            $.get(`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(searchTerm)}&key=${apiKey}&maxResults=10&startIndex=${index}`, function (data, status) {
                //init array
                let booksToMap = [];
                let pages = [];
                //check for existing data
                if (data && data.items) {
                    var idx = 0;
                    var dataWithIndex = data.items.map((d, idx) => { return { ...d, 'idx': idx } });

                    booksToMap = dataWithIndex.reduce(function (result, value, index, array) {
                        if (index % 2 === 0)
                            result.push(array.slice(index, index + 2));
                        return result;
                    }, []);

                    pages = Math.ceil(((data.totalItems - 1) / 10) + 1);
                }
                //display dynamic values in app container
                var html = Mustache.render(BookTemplate, booksToMap);
                $('#bookContainer').html(html);
                if (window.viewType == 'list') {
                    listView();
                }
                else {
                    gridView();
                }
                $('#pageSelect').empty();
                for (let i = 0; i < pages; i++) {
                    if (i + 1 < 6) {
                        if (window.currentPage == i + 1) {
                            $('#pageSelect').append(`<a class="active" href="#" data-page="${i + 1}">${i + 1}</href>`);
                        }
                        else $('#pageSelect').append(`<a href="#" onclick="handlePaging(${i + 1})" data-page="${i + 1}">${i + 1}</href>`);
                    }
                }
            });
        }

        function getBookDetail(bookId) {
            //callout to api to get books
            $.get('https://www.googleapis.com/books/v1/volumes/' + bookId, function (data, status) {
                displayModal(data);
            });
        }
        //init book template
        const apiKey = 'AIzaSyBU-j5ZTve56O3u3I0SnP-6FQCUfgkOHnc';

        const BookTemplate = `
            {{#.}}
                <div class="row">
                    {{#.}}
                        <div class="column">
                            <div class="container">
                                <a href="javascript:void(0)" onclick="getBookDetail('{{id}}')">
                                    <img src="{{volumeInfo.imageLinks.smallThumbnail}}" alt="{{volumeInfo.title}}" style="width:90px">
                                </a>
                                <a href="javascript:void(0)" onclick="getBookDetail('{{id}}')">
                                <h3>Title: <strong>{{volumeInfo.title}}</strong></h3>
                                </a>
                                <h4>Authors: <strong>{{#volumeInfo.authors}} {{.}} {{/volumeInfo.authors}}</strong></h4>
                                <p>{{volumeInfo.subtitle}}</p>
                                <p>Description: {{volumeInfo.description}}</p>
                            </div>
                        </div>
                    {{/.}}    
                </div>
            {{/.}}
                `;

        const BookDetail = ({ ...book }) => `
                
                `;

        $("#searchForm").submit(function (event) {
            if ($("#searchInput").val().trim() === "") {
                alert('Please enter a search term.')
                return;
            }

            const searchTerm = $("#searchInput").val();
            window.currentTerm = searchTerm;
            window.currentPage = '1';
            $.get(`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(searchTerm)}&key=${apiKey}&maxResults=10&startIndex=1`, function (data, status) {
                //init array
                let booksToMap = [];
                let pages = [];
                //check for existing data
                if (data && data.items) {
                    var idx = 0;
                    var dataWithIndex = data.items.map((d, idx) => { return { ...d, 'idx': idx } });

                    booksToMap = dataWithIndex.reduce(function (result, value, index, array) {
                        if (index % 2 === 0)
                            result.push(array.slice(index, index + 2));
                        return result;
                    }, []);

                    pages = Math.ceil(((data.totalItems - 1) / 10) + 1);
                }
                //display dynamic values in app container
                var html = Mustache.render(BookTemplate, booksToMap);
                $('#bookContainer').html(html);
                $('#pageSelect').empty();
                for (let i = 0; i < pages; i++) {
                    if (i + 1 < 6) {
                        if (window.currentPage == i + 1) {
                            $('#pageSelect').append(`<a class="active" href="#" data-page="${i + 1}">${i + 1}</href>`);
                        }
                        else $('#pageSelect').append(`<a href="#" onclick="handlePaging(${i + 1})" data-page="${i + 1}">${i + 1}</href>`);
                    }
                }
            });
            event.preventDefault();
        });

        $(document).ready(function () {
            //callout to api to get books https://books.googleapis.com/books/v1/users/[USERID]/bookshelves/[SHELF]?
            // $.get(`https://googleapis.com/books/v1/users/17904204916938124810/bookshelves/0&key=${apiKey}`, 
            $.get(`https://www.googleapis.com/books/v1/users/117904204916938124810/bookshelves/1001/volumes?key=${apiKey}`,
                function (data, status) {
                    //init array
                    let booksToMap = {};
                    //check for existing data
                    if (data && data.items) {
                        var idx = 0;
                        var dataWithIndex = data.items.map((d, idx) => { return { ...d, 'idx': idx } });

                        //group books in sets of two
                        booksToMap = dataWithIndex.reduce(function (result, value, index, array) {
                            if (index % 2 === 0)
                                result.push(array.slice(index, index + 2));
                            return result;
                        }, []);
                    }
                    var html = Mustache.render(BookTemplate, booksToMap);
                    $('#bookShelfContainer').html(html);
                });
        });
    </script>
</body>

</html>